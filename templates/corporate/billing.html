{% extends "zerver/portico.html" %}
{% set entrypoint = "billing" %}

{% block title %}
<title>{{ _("Billing") }} | Zulip</title>
{% endblock %}

{% block portico_content %}

<div class="app portico-page">
    <div class="billing-upgrade-page">
        <div class="page-content">
            <div class="main">
                <div class="alert alert-danger" id="error-message-box"></div>
                <h1>Zulip Cloud billing for {{ org_name }}</h1>
                {% if admin_access and has_active_plan %}

                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}" />
                <div class="white-box">
                    <div class="input-box no-validation">
                        <label for="org_current_plan" class="inline-block label-title">Your plan</label>
                        <div id="org_current_plan" class="billing-page-text-value">
                            {% if free_trial %}
                            {{ plan_name }} Free Trial
                            {% else %}
                            {{ plan_name }}
                            {% endif %}
                        </div>
                    </div>
                    <div class="input-box no-validation">
                        <label for="org_billing_freqency" class="inline-block label-title">Billing frequency</label>
                        <div id="org_billing_freqency" class="billing-page-text-value">
                            {{ billing_frequency }}
                            {% if switch_to_annual_at_end_of_cycle %}
                            <br />
                            Your plan will switch to annual billing on {{ renewal_date }}.
                            {% endif %}
                        </div>
                    </div>
                    <div class="input-box no-validation">
                        {% if automanage_licenses %}
                        <label for="automatic-license-count" class="inline-block label-title">
                            Number of licenses
                            <a href="/help/zulip-cloud-billing#what-is-the-difference-between-automatic-and-manual-billing" target="_blank" rel="noopener noreferrer">
                                <i class="fa fa-question-circle-o" aria-hidden="true"></i>
                            </a>
                        </label>
                        <div id="automatic-license-count" class="billing-page-text-value">
                            {{ licenses }}  (managed automatically)
                        </div>
                        {% else %}
                        <label for="manual-license-count" class="inline-block label-title">
                            Number of licenses for current billing period
                            <a href="/help/zulip-cloud-billing#what-is-the-difference-between-automatic-and-manual-billing" target="_blank" rel="noopener noreferrer">
                                <i class="fa fa-question-circle-o" aria-hidden="true"></i>
                            </a>
                        </label>
                        <div id="manual-license-count" class="billing-page-text-value">
                            <input type="number" id="billing-current-manual-license-count-input" value="{{ licenses }}" />
                            licenses ({{ seat_count }} in use)
                        </div>
                        <div class="input-box">
                            <button class="update-licenses-button register-button">Update</button>
                        </div>
                            {%if not downgrade_at_end_of_cycle %}
                            <label for="manual-license-count" class="inline-block label-title">
                                Number of licenses for next billing period
                                <a href="/help/zulip-cloud-billing#what-is-the-difference-between-automatic-and-manual-billing" target="_blank" rel="noopener noreferrer">
                                    <i class="fa fa-question-circle-o" aria-hidden="true"></i>
                                </a>
                            </label>
                            <div id="manual-license-count" class="billing-page-text-value">
                                <input type="number" id="billing-next-manual-license-count-input" value="{{ licenses }}" />
                                licenses ({{ seat_count }} in use)
                            </div>
                            <div class="input-box">
                                <button class="update-licenses-button register-button">Update</button>
                            </div>
                            {% endif %}
                        <div class="manual-license-update-error-message"></div>
                        {% endif %}
                    </div>
                    <div id="cardchange-error" class="alert alert-danger"></div>
                    <div class="input-box no-validation">
                        <label for="customer-payment-method" class="inline-block label-title">Payment method</label>
                        <div id="customer-payment-method" class="billing-page-text-value">
                            {{ payment_method }}
                        </div>
                        {% if charge_automatically %}
                        <button class="btn-info" id="update-card-button" class="stripe-button-el">Update card</button>
                        {% endif %}
                    </div>
                    <div id="cardchange-loading">
                        <div class="zulip-loading-logo">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 773.12 773.12">
                                <circle cx="386.56" cy="386.56" r="386.56"/>
                                <path d="M566.66 527.25c0 33.03-24.23 60.05-53.84 60.05H260.29c-29.61 0-53.84-27.02-53.84-60.05 0-20.22 9.09-38.2 22.93-49.09l134.37-120c2.5-2.14 5.74 1.31 3.94 4.19l-49.29 98.69c-1.38 2.76.41 6.16 3.25 6.16h191.18c29.61 0 53.83 27.03 53.83 60.05zm0-281.39c0 20.22-9.09 38.2-22.93 49.09l-134.37 120c-2.5 2.14-5.74-1.31-3.94-4.19l49.29-98.69c1.38-2.76-.41-6.16-3.25-6.16H260.29c-29.61 0-53.84-27.02-53.84-60.05s24.23-60.05 53.84-60.05h252.54c29.61 0 53.83 27.02 53.83 60.05z"/>
                            </svg>
                        </div>
                        <div id="cardchange_loading_indicator"></div>
                    </div>
                    <div id="cardchange-success" class="alert alert-success">
                        Redirecting to Stripe checkout page for updating Card details.
                    </div>
                    <div class="next-payment-info billing-page-text-value">
                        {% if renewal_amount %}
                            {% if free_trial %}
                            Your plan will be upgraded to <strong>{{ plan_name }}</strong> on <strong>{{ renewal_date }}</strong> for
                            <strong>${{ renewal_amount }}</strong>.
                            {% elif downgrade_at_end_of_cycle %}
                            Your plan will be downgraded to <strong>Zulip Free</strong> on <strong>{{ renewal_date }}</strong>.
                            {% elif switch_to_annual_at_end_of_cycle %}
                            Your plan will be switched from monthly to annual billing on <strong>{{ renewal_date }}</strong>.
                            {% else %}
                                {% if charge_automatically %}
                                Your plan will automatically renew on <strong>{{ renewal_date }}</strong>.
                                {% else %}
                                Your next invoice is due on <strong>{{ renewal_date }}</strong>.
                                {% endif %}
                            <br />
                            Expected charge: <strong>${{ renewal_amount }}</strong>.
                            {% endif %}
                        {% else %}
                            Your plan ends on <strong>{{ renewal_date }}</strong>, and does not renew.
                        {% endif %}
                    </div>
                    <div class="input-box no-validation">
                        <label for="org_current_plan" class="inline-block label-title">Billing contact</label>
                        <div id="org_current_plan" class="billing-page-text-value">
                            <a href="mailto:alya@zulip.com">alya@zulip.com</a>
                        </div>
                    </div>
                    <div class="input-box">
                        <button class="cancel-plan">
                            {% if downgrade_at_end_of_cycle %}
                            Reactivate subscription
                            {% else %}
                            Cancel plan
                            {% endif %}
                        </button>
                    </div>
                </div>
                <div id="goto-zulip-organization-link">
                    {% if onboarding %}
                    <br />
                    <h3>
                        <b><a href="/">Go to your Zulip organization</a></b>
                    </h3>
                    {% endif %}
                </div>
                <hr />
                <div class="support-link">
                    <p>
                        To make changes to your plan or view your billing history <a href="mailto:support@zulip.com">contact Zulip support</a>.
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>


<div id="confirm-licenses-modal" class="micromodal" aria-hidden="true">
    <div class="modal__overlay" tabindex="-1">
        <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="dialog_title">
            <header class="modal__header">
                <h1 class="modal__title dialog_heading">
                    {{ _('Confirm license increase') }}
                </h1>
                <button class="modal__close" aria-label="{{ _('Close modal') }}" data-micromodal-close></button>
            </header>
            <main class="modal__content">
                <p>
                    Are you sure you want to increase the licenses from
                    <b><span id="current_license_count_holder"></span></b> to
                    <b><span id="new_license_count_holder"></span></b>?
                </p>
                <p>
                    You would be charged for the additional licenses.
                </p>
            </main>
            <footer class="modal__footer">
                <button class="modal__btn dialog_exit_button" aria-label="{{ '(Close this dialog window)' }}" data-micromodal-close>{{ _('Cancel') }}</button>
                <button class="modal__btn dialog_submit_button">
                    <span>{{ _('Confirm') }}</span>
                </button>
            </footer>
        </div>
    </div>
</div>
{% endblock %}
